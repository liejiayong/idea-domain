(window.webpackJsonp=window.webpackJsonp||[]).push([[74],{685:function(s,t,a){"use strict";a.r(t);var n=a(9),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"前言"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),a("p",[s._v("始初开发移动端新项目，用上 vue3 和 ViteJS 即可一劳而永逸，然而在测试时发现某些低版本（一般指 Android 7 及以下版本）的安卓手机浏览器出现白屏的现象，而 ios 机型基本上是好的。在调试后发现在低版本浏览器并不支持原生 ESM 导入的方式，于是乎有了这篇文章做记录。")]),s._v(" "),a("h1",{attrs:{id:"兼容原生-esm-的浏览器"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#兼容原生-esm-的浏览器"}},[s._v("#")]),s._v(" "),a("a",{attrs:{href:"https://vitejs.cn/guide/build.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("兼容原生 ESM 的浏览器"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("默认情况下，Vite 的目标浏览器是指能够 支持原生 ESM script 标签 和 支持原生 ESM 动态导入 的。")]),s._v(" "),a("p",[s._v("作为参考，Vite 使用这个 browserslist 作为查询标准：")]),s._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("defaults and supports es6-module and supports es6-module-dynamic-import, not opera > 0, not samsung > 0, not and_qq > 0\n\nChrome >=87\nFirefox >=78\nSafari >=13\nEdge >=88\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br")])]),a("h1",{attrs:{id:"解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方法"}},[s._v("#")]),s._v(" 解决方法")]),s._v(" "),a("ol",[a("li",[a("p",[s._v("在"),a("code",[s._v("vite.config.ts")]),s._v(" 文件的 "),a("code",[s._v("build.target")]),s._v(" 配置项 指定构建目标为 "),a("code",[s._v("es2015")])])]),s._v(" "),a("li",[a("p",[s._v("安装插件 "),a("code",[s._v("@vitejs/plugin-legacy")]),s._v("。")])])]),s._v(" "),a("div",{staticClass:"language-bash line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("pnpm")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" @vitejs/plugin-legacy -D\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br")])]),a("p",[s._v("插件会自动生成传统浏览器的 chunk 及与其相对应 ES 语言特性方面的 polyfill。兼容版的 chunk 只会在不支持原生 ESM 的浏览器中进行按需加载。")]),s._v(" "),a("h1",{attrs:{id:"最终效果"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#最终效果"}},[s._v("#")]),s._v(" 最终效果")]),s._v(" "),a("div",{staticClass:"language-ts line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// vite.config.ts")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" defineConfig "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'vite'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" vue "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@vitejs/plugin-vue'")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" ViteLegacy "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'@vitejs/plugin-legacy'")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// https://vitejs.dev/config/")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("defineConfig")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  plugins"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vue")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("ViteLegacy")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      targets"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'chrome 52'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      additionalLegacyPolyfills"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'regenerator-runtime/runtime'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/* 兼容IE11 */")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      renderLegacyChunks"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// polyfills: [")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.symbol',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.array.concat',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.array.filter',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.array.flat',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.array.flat-map',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.promise',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.promise.finally',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es/map',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es/set',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.array.for-each',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.object.define-properties',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.object.define-property',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.object.get-own-property-descriptor',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.object.get-own-property-descriptors',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.object.keys',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'es.object.to-string',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'web.dom-collections.for-each',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'esnext.global-this',")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//   'esnext.string.match-all'")]),s._v("\n      "),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ]")]),s._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  build"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    target"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'es2015'")]),s._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[s._v("1")]),a("br"),a("span",{staticClass:"line-number"},[s._v("2")]),a("br"),a("span",{staticClass:"line-number"},[s._v("3")]),a("br"),a("span",{staticClass:"line-number"},[s._v("4")]),a("br"),a("span",{staticClass:"line-number"},[s._v("5")]),a("br"),a("span",{staticClass:"line-number"},[s._v("6")]),a("br"),a("span",{staticClass:"line-number"},[s._v("7")]),a("br"),a("span",{staticClass:"line-number"},[s._v("8")]),a("br"),a("span",{staticClass:"line-number"},[s._v("9")]),a("br"),a("span",{staticClass:"line-number"},[s._v("10")]),a("br"),a("span",{staticClass:"line-number"},[s._v("11")]),a("br"),a("span",{staticClass:"line-number"},[s._v("12")]),a("br"),a("span",{staticClass:"line-number"},[s._v("13")]),a("br"),a("span",{staticClass:"line-number"},[s._v("14")]),a("br"),a("span",{staticClass:"line-number"},[s._v("15")]),a("br"),a("span",{staticClass:"line-number"},[s._v("16")]),a("br"),a("span",{staticClass:"line-number"},[s._v("17")]),a("br"),a("span",{staticClass:"line-number"},[s._v("18")]),a("br"),a("span",{staticClass:"line-number"},[s._v("19")]),a("br"),a("span",{staticClass:"line-number"},[s._v("20")]),a("br"),a("span",{staticClass:"line-number"},[s._v("21")]),a("br"),a("span",{staticClass:"line-number"},[s._v("22")]),a("br"),a("span",{staticClass:"line-number"},[s._v("23")]),a("br"),a("span",{staticClass:"line-number"},[s._v("24")]),a("br"),a("span",{staticClass:"line-number"},[s._v("25")]),a("br"),a("span",{staticClass:"line-number"},[s._v("26")]),a("br"),a("span",{staticClass:"line-number"},[s._v("27")]),a("br"),a("span",{staticClass:"line-number"},[s._v("28")]),a("br"),a("span",{staticClass:"line-number"},[s._v("29")]),a("br"),a("span",{staticClass:"line-number"},[s._v("30")]),a("br"),a("span",{staticClass:"line-number"},[s._v("31")]),a("br"),a("span",{staticClass:"line-number"},[s._v("32")]),a("br"),a("span",{staticClass:"line-number"},[s._v("33")]),a("br"),a("span",{staticClass:"line-number"},[s._v("34")]),a("br"),a("span",{staticClass:"line-number"},[s._v("35")]),a("br"),a("span",{staticClass:"line-number"},[s._v("36")]),a("br"),a("span",{staticClass:"line-number"},[s._v("37")]),a("br"),a("span",{staticClass:"line-number"},[s._v("38")]),a("br"),a("span",{staticClass:"line-number"},[s._v("39")]),a("br"),a("span",{staticClass:"line-number"},[s._v("40")]),a("br")])]),a("h1",{attrs:{id:"相关文献"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#相关文献"}},[s._v("#")]),s._v(" 相关文献")]),s._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://vitejs.cn/config/#build-target",target:"_blank",rel:"noopener noreferrer"}},[s._v("ViteJS 文档-build-target"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://vitejs.cn/guide/build.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("ViteJS 文档-构建生产版本_浏览器兼容性"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/vitejs/vite/tree/main/packages/plugin-legacy#readme",target:"_blank",rel:"noopener noreferrer"}},[s._v("vite-plugin-legacy"),a("OutboundLink")],1)]),s._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/browserslist/browserslist",target:"_blank",rel:"noopener noreferrer"}},[s._v("browserslist"),a("OutboundLink")],1)])])])}),[],!1,null,null,null);t.default=e.exports}}]);